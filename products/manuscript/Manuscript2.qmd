---
title: "Manuscript for Foodborne-Outbreak Project"
author: "Weifan Wu & Kailin (Kai) Chen"
date: "May 2023"
format:
  html
bibliography: ../references.bib
csl: ../apa.csl
---

```{r echo = FALSE, warning = FALSE, paged.print = TRUE}
# Load Libraries
library(here)
library(knitr)
library(tidyverse)
library(broom)
library(ggtext)
library(flextable)
```

# Summary/Abstract

# Introduction

## General Background Information

Foodborne pathogens can cause serious gastrointestinal infections. About 600 million cases of foodborne disease are reported worldwide, with almost 1/10 of these cases caused by contaminated food [@he2023]. On average within the United States each year, 1 in 6 Americans will acquire foodborne illness; 128,000 will be hospitalized, and 3,000 will die [@centerforfoodsafetyandappliednutrition2022]. Economic loss associated with food poisoning is estimated to be greater than 50 billion US dollars annually. Restaurants are frequently sites attributed to mass-outbreaks, and typical foods associated with these outbreaks include improperly-prepared meats and vegetables [@mun2020; @sarno2021]. Disease etiologies range from bacteria (ex: *Salmonella* spp. and *E. coli*) to viruses (norovirus and rotavirus), to parasites (*Cryptosporidium* spp. and *Cyclospora* spp. [@cdc2022]. Environmental factors such as heavy metals can also cause foodborne illness.

### Questions & Hypotheses

To verify pathogens of greatest concern, common settings associated with food poisoning, and foods typically associated with such outbreaks, this study was launched as a research project at the University of Georgia using information gathered over a 17-year period from the Centers for Disease Control and Prevention (CDC).

From this research project, we would like to answer the following questions:

-   What are the most frequent locations that foodborne outbreaks occur?

-   What pathogen species are most frequently associated with foodborne outbreaks?

-   What type of food is most often seen for foodborne outbreaks?

In other words, immediate outcomes of interest are location, disease etiology, and food category. These will act as predictors for the health outcomes of interest: illnesses and hospitalizations.

Our hypotheses include:

-   Outbreaks occur most often in homes rather than restaurants.

-   The most common pathogen associated with foodborne disease outbreaks is *E. coli*.

-   The food most commonly associated with foodborne outbreaks consists of salad.

# Methods

## Data Sources, Acquisition, and Description

Two datasets were adopted for this research. The first dataset--which was used to build statistical models for the study--was uploaded onto *Kaggle* in 2017, with 12 variables and more than 16,950 observations spanning almost two decades from 1998 to 2015 [@cdc2017a]. The second dataset--which was used for machine learning--was retrieved from the CDC's National Outbreak Reporting System (NORS) website. This second dataset covers reports of foodborne and waterborne disease outbreaks, as well as enteric disease outbreaks spread by contact with environmental sources, infected animals or persons, and other means from 2009 to 2020.

## Data Importation and Cleaning

The datasets were downloaded from their respective sites and imported into R/RStudio using the `tidyverse` and `readxl` packages. Afterwards, the data structure for each file was analyzed, including how many "NA" values were present for each column in the dataset. Only observations pertaining to foodborne disease were kept. Variables containing less than 80% "NA" values, including predictors and outcomes of interest, were retained. For the designated "training data", cases that did not have laboratory-confirmed tests were filtered out. Variables for pathogen type (virus, bacteria, parasite, and poison) and `Simplified Etiology` were created based on pathogen species. For both datasets, `Location` was formatted identically to maintain compatibility for eventual machine learning. `IFSAC Category` was also created in the training data based on the formatting of the "test data" and modified to include salads, desserts, and poultry. To address coinfections, observations containing multiple pathogen etiologies were separated into different rows. Finally, both datasets were modified to contain identical columns prior to being saved as "processed data" in the appropriate subdirectory.

For more information, please see the "processingfile_v1.qmd" file located in the "processing_code" folder of the "code" subdirectory.

## Statistical Analysis

### Exploratory

After processing procedures, an exploratory data analysis was performed to view general relationships between predictors (time, pathogen type, pathogen etiology, state, and food type) and the health outcomes of interest (illnesses and hospitalizations).

### Machine Learning

Linear and Poisson regression models were afterwards constructed using the aforementioned predictors and outcomes from the training data. Data was resampled using the bootstrapping approach 1,000 times for better estimates of accuracy and variability of model coefficients. Random forest and bagging models were also trained to predict health outcomes using the Kaggle dataset for the NORS-CDC data. RMSE was used to compare each of the models. The best model built from the training data was then employed for the test data.

For more information, please refer to the "statistical_analysis.qmd" file inside the "analysis_code" folder of the "code" subdirectory.

# Results

## Exploratory Analysis

### Training Data

```{r Table of Hospitalizations by State}
first_table <- readRDS("../../results/state_v_hospitalization_training.rds") %>% 
  rename(Hospitalizations = all_hospitalizations)
first_table <- flextable(first_table)
first_table <- theme_vanilla(first_table)
first_table <- set_caption(first_table, caption = as_paragraph(colorize("Table 1. Hospitalizations by state from 1998 to 2015.", color = "black")))
first_table <- set_table_properties(first_table, layout = "autofit")
first_table
```

![Figure 1. Hospitalizations by food type from 1998-2015.](images/Food_type_v_hospitalization-01.png)

```{r}
second_table <- readRDS("../../results/training_food_vs_illnesses.rds") %>% 
  select(`IFSAC Category`, all_illnesses) %>% 
  rename(Illnesses = all_illnesses)
second_table <- flextable(second_table)
second_table <- theme_vanilla(second_table)
second_table <- set_caption(second_table, caption = as_paragraph(colorize("Table 2. Illnesses by food type from 1998 to 2015.", color = "black")))
second_table
```

### Test Data

![Figure 2. Illness over time by pathogen type (2009-2020).](images/time_v_illness_pathogen_type.png)

![Figure 3. Illnesses by outbreak location (2009-2020).](images/Location_v_Illness-01.png)

![Figure 4. Bacterial etiology by outbreak frequency (2009-2020).](images/bacterial_etiology_v_outbreak_frequency.png)

## Statistical Analysis

### Basic

Between simple and multivariate regressions, multivariate models performed better with lower associated RMSEs. For both health outcomes, the multivariate linear regression models (RMSE = 58.4, 5.50) constructed performed better than multivariate poisson regression models (RMSE = 59.7, 5.64).

![Figure 5. Predicted illnesses versus actual illness count for multivariate linear regression model.](images/Predicted%20Illnesses%20VS%20Illnesses%20by%20linear%20regression%20with%20all%20predictors.png){fig-align="center"}

### Machine Learning

```{r Model RMSE Comparison, paged.print=TRUE}
# Illness Models 
rmarkdown::paged_table(readRDS("../../results/illness_rmse_models.rds"))

# Hospitalization Models
rmarkdown::paged_table(readRDS("../../results/hospital_rmse_models.rds"))
```

Overall, between itself and the other models (linear regression, poisson regression, and bagging) generated, the random forest model performed the best for both health outcomes with the lowest RMSEs (55.7, 5.05).

### Final Fit with Test Data

Fitting the finalized random forest model to the test data resulted in RMSEs of 36.6 and 6.70 for the health outcomes of illnesses and hospitalizations, respectively.

# Discussion

## Summary and Interpretations

Exploratory data visualization demonstrates bacteria contribute to the majority outbreaks, and all outbreaks with illnesses numbering over 1,000 and hospitalizations over 100 are attributed to bacteria. From all pathogen types, bacteria are thus associated with worse health outcomes when it comes to food poisoning.

From 1998 to 2015, multistate outbreaks caused the most illnesses (N = 18,617) and hospitalizations (3,506) than any in-state outbreak. The fact that multistate outbreaks were seen more often than in any individual state for illnesses and hospitalizations suggests that these disease outbreaks typically involve a regional or national ingredient distributor. Hence, it would be reasonable to suggest laboratory sampling of goods, especially for bacteria, as a safety benchmark upon arrival at their destinations.

In terms of food categories, poultry was identified to have caused the most hospitalizations (N = 770), followed closely by fruits and beef. Interestingly, however, salads were found to cause the most illnesses (N = 11,493). Upon addition of total hospitalizations and illnesses for both poultry and salads, salads were determined to have the highest number of cases in total, which confirms our original hypothesis.

The remaining two of the three initial hypotheses were proved incorrect. Instead of *E. coli*, results overall indicated that *Salmonella* spp. are the most common pathogens linked to foodborne disease; these bacteria contribute to the greatest amount of illnesses and hospitalizations in comparison to other disease agents for our data. Finally, we also see that food poisoning is most frequently linked to restaurants instead of private households.

\[Something about machine learning here???\]

These results offer insight into common disease characteristics across food poisoning cases, which is greatly useful for epidemiologists and other public health professionals to anticipate which areas to investigate first for future outbreaks.

## Strengths and Limitations

# Conclusion

Food poisoning in the United States poses a great concern to public health in terms of both morbidity and economic costs. Previous surveillance data points to *Salmonella* bacteria and salads as the main cause and medium for foodborne disease outbreaks, along with the most common setting for such outbreaks being a restaurant. These findings will also give future outbreak investigators a first direction to consider in the field.

# References
